location = /oauth2/sign_in {
  internal;
  proxy_pass https://nodejs-theia-proxy:443/oauth2/sign_in;
}

location = /oauth2/auth {
  internal;
  proxy_pass https://nodejs-theia-proxy:443;
}

location /oauth2/ {
  proxy_pass       https://nodejs-theia-proxy:443;
  proxy_set_header Host                    $host;
  proxy_set_header X-Real-IP               $remote_addr;
  proxy_set_header X-Scheme                $scheme;
  proxy_set_header X-Auth-Request-Redirect $request_uri;
}
  
location ~ ^/nodejs-theia-example/(.*)$  {  
  auth_request /oauth2/auth;
  error_page 401 = /oauth2/sign_in;
  
  proxy_pass http://$ab/$1;
  auth_request_set $user   $upstream_http_x_auth_request_user;
  auth_request_set $email  $upstream_http_x_auth_request_email;
  proxy_set_header X-User  $user;
  proxy_set_header X-Email $email;
  add_header X-Test-Email "Email $email";

  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection $connection_upgrade;
}
